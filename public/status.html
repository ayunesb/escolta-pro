<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Service Status</title>
    <style>
      body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial;margin:24px}
      label,input,button{font-size:14px}
      .ok{color:green}
      .bad{color:red}
      pre{background:#f6f8fa;padding:12px;border-radius:6px}
    </style>
  </head>
  <body>
    <h1>Supabase Functions Status</h1>
    <p>Enter your Supabase project ref (like <code>isnezquuwepqcjkaupjh</code>) and click Check.</p>
    <div>
      <label>Project ref: <input id="ref" placeholder="project-ref" /></label>
      <button id="check">Check</button>
    </div>
    <hr/>
    <div id="out"></div>

    <script>
      const out = document.getElementById('out')
      function el(txt, cls=''){
        const d = document.createElement('div'); d.innerHTML = txt; if(cls) d.className = cls; return d
      }
      async function check(){
        out.innerHTML = ''
        const ref = document.getElementById('ref').value.trim()
        if(!ref){ out.appendChild(el('<em>Set project ref first</em>','bad')); return }
        const base = `https://${ref}.functions.supabase.co`
        out.appendChild(el(`<h3>Health</h3>`))
        try{
          const r = await fetch(base + '/health')
          const txt = await r.text()
          out.appendChild(el(`<pre>${r.status} ${r.statusText}\n${txt}</pre>`, r.ok ? 'ok':'bad'))
        }catch(e){ out.appendChild(el(`<pre>${String(e)}</pre>`, 'bad')) }

        out.appendChild(el(`<h3>Validate Quote (sample)</h3>`))
        try{
          const r = await fetch(base + '/validate_quote', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({hours:3,hourly:400,vehicle:0,armed:false})})
          const txt = await r.text()
          out.appendChild(el(`<pre>${r.status} ${r.statusText}\n${txt}</pre>`, r.ok ? 'ok':'bad'))
        }catch(e){ out.appendChild(el(`<pre>${String(e)}</pre>`,'bad')) }
      }
      document.getElementById('check').addEventListener('click', check)
    </script>
  </body>
</html>
