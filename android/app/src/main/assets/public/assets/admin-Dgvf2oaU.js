import{r as d,s as f,a7 as c,j as e,S as E,C as n,a as i,V as h,W as u,B as C,b as A,u as z,g as F,Q as D,c as M,T as H,A as O,d as Q,e as X,f as V,h as $,E as J,k as K}from"./ErrorBoundary-B6nv__G6.js";import{g as W,t,L as Y,a as b,B as T,E as I,U as P}from"./language-toggle-B3OBkquI.js";import{T as Z,a as ee,b as se,c as S,d as k,C as G,f as L}from"./tabs-CVJ30HFQ.js";const re=({navigate:o})=>{const[j,p]=d.useState([]),[l,w]=d.useState([]),[_,m]=d.useState(!0),[g,x]=d.useState(null),[a]=d.useState(W());d.useEffect(()=>{v()},[]);const v=async()=>{m(!0);try{const{data:s,error:r}=await f.from("companies").select("*").eq("status","pending_review").order("created_at",{ascending:!1});r?console.error("Error loading companies:",r):p(s||[]);const{data:y,error:N}=await f.from("guards").select(`
          *,
          profiles!inner(first_name, last_name, email)
        `).or("status.is.null,status.eq.pending_review").order("id",{ascending:!1});N?console.error("Error loading guards:",N):w(y||[])}catch(s){console.error("Error loading pending items:",s),c({title:"Error",description:"Failed to load pending approvals",variant:"destructive"})}finally{m(!1)}},B=async s=>{x(s);try{const{error:r}=await f.from("companies").update({status:"approved"}).eq("id",s);if(r)throw r;c({title:"Company Approved",description:"Company has been approved and can now operate."}),v()}catch(r){console.error("Error approving company:",r),c({title:"Error",description:"Failed to approve company",variant:"destructive"})}finally{x(null)}},q=async s=>{x(s);try{const{error:r}=await f.from("companies").update({status:"suspended"}).eq("id",s);if(r)throw r;c({title:"Company Suspended",description:"Company has been suspended."}),v()}catch(r){console.error("Error suspending company:",r),c({title:"Error",description:"Failed to suspend company",variant:"destructive"})}finally{x(null)}},R=async s=>{x(s);try{const{error:r}=await f.from("guards").update({status:"approved",active:!0}).eq("id",s);if(r)throw r;c({title:"Guard Approved",description:"Guard has been approved and is now available for bookings."}),v()}catch(r){console.error("Error approving guard:",r),c({title:"Error",description:"Failed to approve guard",variant:"destructive"})}finally{x(null)}},U=async s=>{x(s);try{const{error:r}=await f.from("guards").update({status:"suspended",active:!1}).eq("id",s);if(r)throw r;c({title:"Guard Suspended",description:"Guard has been suspended."}),v()}catch(r){console.error("Error suspending guard:",r),c({title:"Error",description:"Failed to suspend guard",variant:"destructive"})}finally{x(null)}};return _?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-accent"})}):e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"safe-top px-mobile py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-mobile-xl font-bold text-foreground",children:t("super_admin",a)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{}),e.jsx(Z,{}),e.jsx(b,{variant:"secondary",className:"bg-accent/10 text-accent",children:t("admin",a)})]})]}),e.jsxs(ee,{defaultValue:"companies",className:"w-full",children:[e.jsxs(se,{className:"grid w-full grid-cols-3",children:[e.jsxs(S,{value:"companies",className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-4 w-4"}),t("companies",a)," (",j.length,")"]}),e.jsxs(S,{value:"guards",className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-4 w-4"}),t("guards",a)," (",l.length,")"]}),e.jsxs(S,{value:"analytics",className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4"}),"Analytics"]})]}),e.jsx(k,{value:"companies",className:"space-y-4 mt-6",children:j.length===0?e.jsx(n,{children:e.jsxs(i,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(T,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-mobile-lg font-medium mb-2",children:t("no_pending_companies",a)}),e.jsx("p",{className:"text-mobile-sm text-muted-foreground text-center",children:t("all_reviewed",a)})]})}):e.jsx("div",{className:"space-y-4",children:j.map(s=>e.jsxs(n,{children:[e.jsx(h,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(u,{className:"text-mobile-lg",children:s.name}),e.jsxs("p",{className:"text-mobile-sm text-muted-foreground",children:["Tax ID: ",s.tax_id]})]}),e.jsx(b,{variant:"outline",children:s.status})]})}),e.jsxs(i,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-2 text-mobile-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Contact:"})," ",s.contact_name]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Email:"})," ",s.contact_email]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Phone:"})," ",s.contact_phone]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Cities:"})," ",s.cities.join(", ")]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Applied:"})," ",new Date(s.created_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(C,{size:"sm",onClick:()=>B(s.id),disabled:g===s.id,className:"flex-1 bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),t("approve",a)]}),e.jsxs(C,{size:"sm",variant:"destructive",onClick:()=>q(s.id),disabled:g===s.id,className:"flex-1",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),t("suspend",a)]})]})]})]},s.id))})}),e.jsx(k,{value:"guards",className:"space-y-4 mt-6",children:l.length===0?e.jsx(n,{children:e.jsxs(i,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(E,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-mobile-lg font-medium mb-2",children:t("no_pending_guards",a)}),e.jsx("p",{className:"text-mobile-sm text-muted-foreground text-center",children:t("all_reviewed",a)})]})}):e.jsx("div",{className:"space-y-4",children:l.map(s=>{var r,y,N;return e.jsxs(n,{children:[e.jsx(h,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-muted rounded-full flex items-center justify-center",children:s.photo_url?e.jsx("img",{src:s.photo_url,alt:"Guard",className:"w-full h-full rounded-full object-cover"}):e.jsx(P,{className:"h-6 w-6 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsxs(u,{className:"text-mobile-lg",children:[(r=s.profiles)==null?void 0:r.first_name," ",(y=s.profiles)==null?void 0:y.last_name]}),e.jsx("p",{className:"text-mobile-sm text-muted-foreground",children:(N=s.profiles)==null?void 0:N.email})]})]}),e.jsx(b,{variant:"outline",children:s.status||"pending"})]})}),e.jsxs(i,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-mobile-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Base Rate:"}),e.jsx("br",{}),L(s.hourly_rate_mxn_cents),"/hr"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Armed Surcharge:"}),e.jsx("br",{}),L(s.armed_hourly_surcharge_mxn_cents),"/hr"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"City:"}),e.jsx("br",{}),s.city||"Not specified"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Rating:"}),e.jsx("br",{}),"⭐ ",s.rating.toFixed(1)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(C,{size:"sm",onClick:()=>R(s.id),disabled:g===s.id,className:"flex-1 bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),t("approve",a)]}),e.jsxs(C,{size:"sm",variant:"destructive",onClick:()=>U(s.id),disabled:g===s.id,className:"flex-1",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),t("suspend",a)]})]})]})]},s.id)})})}),e.jsxs(k,{value:"analytics",className:"space-y-4 mt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs(n,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Total Users"}),e.jsx(P,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold",children:j.length+l.length+150}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+12% from last month"})]})]}),e.jsxs(n,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Active Companies"}),e.jsx(T,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold",children:"23"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+2 this month"})]})]}),e.jsxs(n,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Active Guards"}),e.jsx(E,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold",children:"147"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+18% from last month"})]})]}),e.jsxs(n,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Total Bookings"}),e.jsx(A,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold",children:"1,234"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+25% from last month"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(n,{children:[e.jsx(h,{children:e.jsx(u,{children:"Platform Health"})}),e.jsxs(i,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"System Uptime"}),e.jsx(b,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:"99.9%"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Active Sessions"}),e.jsx("span",{className:"text-sm font-medium",children:"342"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Response Time"}),e.jsx("span",{className:"text-sm font-medium",children:"234ms"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Error Rate"}),e.jsx(b,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:"0.1%"})]})]})]}),e.jsxs(n,{children:[e.jsx(h,{children:e.jsx(u,{children:"Recent Activity"})}),e.jsx(i,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsx("span",{children:'Guard "Carlos M." completed booking #1234'}),e.jsx("span",{className:"text-muted-foreground ml-auto",children:"2m ago"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),e.jsx("span",{children:'New company registration: "SecureGuard MX"'}),e.jsx("span",{className:"text-muted-foreground ml-auto",children:"15m ago"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-500 rounded-full"}),e.jsx("span",{children:"Payment processed for booking #1232"}),e.jsx("span",{className:"text-muted-foreground ml-auto",children:"1h ago"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsx("span",{children:'Guard "Ana L." approved for service'}),e.jsx("span",{className:"text-muted-foreground ml-auto",children:"2h ago"})]})]})})]})]})]})]})]})})},ae=()=>{const{user:o,loading:j,hasRole:p}=z(),[l,w]=d.useState(window.location.hash.slice(1)||"/dashboard");d.useEffect(()=>{const m=()=>{const g=window.location.hash.slice(1)||"/dashboard";w(g)};return window.addEventListener("hashchange",m),()=>window.removeEventListener("hashchange",m)},[]);const _=m=>{window.location.hash=m,w(m)};if(j)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-accent"})});if(!o)return e.jsx(F,{});if(!p("company_admin"))return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground mb-4",children:"Access Denied"}),e.jsx("p",{className:"text-muted-foreground",children:"You don't have permission to access this area."})]})});switch(l){case"/dashboard":default:return e.jsx(re,{navigate:_})}},te=new D,ne=()=>(console.log("✅ Admin App component rendered"),e.jsx(M,{client:te,children:e.jsx(H,{defaultTheme:"dark",storageKey:"blindado-admin-theme",children:e.jsx(O,{children:e.jsxs(Q,{children:[e.jsx(X,{}),e.jsx(V,{}),e.jsx(ae,{}),e.jsx("div",{id:"overlays"})]})})})}));console.log("🚀 Admin app initializing...");typeof window<"u"&&(console.log=()=>{},console.warn=()=>{},window.addEventListener("error",o=>{var p,l;fetch("https://isnezquuwepqcjkaupjh.supabase.co/functions/v1/performance_monitor",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({operation:"report",metrics:[{operation:"global_error",duration_ms:0,success:!1,error:((p=o.error)==null?void 0:p.message)||"Unknown error",metadata:{filename:o.filename,lineno:o.lineno,colno:o.colno,stack:(l=o.error)==null?void 0:l.stack,timestamp:new Date().toISOString(),app:"admin"}}]})}).catch(()=>{})}));$(document.getElementById("root")).render(e.jsx(d.StrictMode,{children:e.jsx(J,{children:e.jsx(K,{children:e.jsx(ne,{})})})}));
